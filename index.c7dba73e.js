!function(){function t(t){t.preventDefault();var e=t.touches[0];r=e.pageX,i=e.pageY}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function n(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,n){if(t){if("string"==typeof t)return e(t,void 0);var r=Object.prototype.toString.call(t).slice(8,-1);if("Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return e(t,void 0)}}(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var r,i,s,o,a=document.querySelector(".game-field tbody"),u={left:function(t,e){return function(t,e){for(var n=0;n<t.length;n++)for(var r=t[n],i=r.length-1,s=0,o=!1,a=0;a<i&&!o;a++){if(a===s&&r[a]===e[n][a]){s++;continue}if(!r[a]){o=!0,r.splice(a,1),r.push(0);continue}r[a+1]&&r[a]===r[a+1]&&(o=!0,r[a]=2*+r[a],r.splice(a+1,1),r.push(0))}return t}(t,e)},right:function(t,e){return function(t,e){for(var n=0;n<t.length;n++)for(var r=t[n],i=!1,s=r.length-1,o=r.length-1;o>0&&!i;o--){if(o===s&&r[o]===e[n][o]){s--;continue}if(!r[o]){i=!0,r.splice(o,1),r.unshift(0);continue}r[o-1]&&r[o]===r[o-1]&&(i=!0,r[o]=2*+r[o],r.splice(o-1,1),r.unshift(0))}return t}(t,e)},up:function(t,e){return function(t,e){for(var n=0;n<t.length;n++)for(var r=t.length-1,i=0,s=!1,o=0;o<r&&!s;o++){if(o===i&&t[o][n]===e[o][n]){i++;continue}if(!t[o][n]){s=!0,g(t,o,n);continue}t[o+1][n]&&t[o][n]===t[o+1][n]&&(t[o][n]*=2,s=!0,g(t,o+1,n))}return t}(t,e)},down:function(t,e){return function(t,e){for(var n=0;n<t.length;n++)for(var r=!1,i=t.length-1,s=t.length-1;s>0&&!r;s--){if(i===s&&t[s][n]===e[s][n]){i--;continue}if(!t[s][n]){r=!0,m(t,s,n);continue}t[s-1][n]&&t[s][n]===t[s-1][n]&&(t[s][n]=2*+t[s][n],r=!0,m(t,s-1,n))}return t}(t,e)}},c=null,l=null;function f(t,e){if(c){if(!h(c,t))return;clearTimeout(l),y(),d(c),c=null,l=null}var n=[v(y())];if(!h(n[0],t)){d(t);return}if(e){for(;;)if(n.push(v(u[e](v(n.at(-1)),t))),!h(n.at(-1),n.at(-2))){n.pop(),n.shift(),n[n.length-1]=t;break}c=t,function t(e,n){if(y(),d(e.shift()),e.length){l=setTimeout(t,n,e,n);return}c=null,l=null}(n,250/n.length);return}d(t)}function h(t,e){for(var n=0;n<t.length;n++)for(var r=0;r<t[n].length;r++)if(t[n][r]!==e[n][r])return!0;return!1}function v(t){return t.map(function(t){return n(t)})}function d(t){for(var e=0;e<t.length;e++)for(var n=t[e],r=0;r<n.length;r++)t[e][r]&&(a.rows[e].cells[r].textContent=t[e][r],a.rows[e].cells[r].classList.add("field-cell--".concat(t[e][r])))}function g(t,e,n){for(var r=t.length-1,i=e;i<r;i++)t[i][n]=t[i+1][n];t[r][n]=0}function m(t,e,n){for(var r=e;r>0;r--)t[r][n]=t[r-1][n];t[0][n]=0}function y(){for(var t=[],e=0;e<a.rows.length;e++){t.push([]);for(var n=a.rows[e].cells,r=0;r<n.length;r++)t[e].push(+n[r].textContent),n[r].textContent&&(n[r].classList.remove("field-cell--".concat(n[r].textContent)),n[r].textContent="")}return t}function p(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function w(t,e){return Math.floor(Math.random()*(e-t))+t}var k=new(function(){var t;function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.createField();!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,e),p(this,"size",4),p(this,"probability",10),p(this,"status",{started:!1,lost:!1,won:!1}),p(this,"score",0),this.state=t,this.initialState=this.copyState(t)}return t=[{key:"start",value:function(){if(!this.isPlaying){this.status.started=!0;for(var t=0;t<2;t++)this.addRandomCell()}}},{key:"restart",value:function(){this.score=0,this.state=this.copyState(this.initialState),this.status.won=!1,this.status.lost=!1,this.status.started=!1}},{key:"moveRow",value:function(t){if(this.isPlaying){for(var e=this.getState(),n=0;n<this.size;n++)this.state[n]=this.stackRow(this.state[n],t);this.isChanged(e)&&(this.addRandomCell(),this.status.lost=this.isLost)}}},{key:"moveColumn",value:function(t){var e=this,n=function(n){e.stackRow(e.state.map(function(t){return t[n]}),t).forEach(function(t,e){return r.state[e][n]=t})},r=this;if(this.isPlaying){for(var i=this.getState(),s=0;s<this.size;s++)n(s);this.isChanged(i)&&(this.addRandomCell(),this.status.lost=this.isLost)}}},{key:"stackRow",value:function(t,e){for(var n=t.filter(Boolean),r=1;r<n.length;r++)if(n[r-1]===n[r]){var i=2*n[r-1];2048===i&&(this.status.won=!0),n[r-1]=i,this.score+=i,n.splice(r,1)}for(;n.length!==this.size;)e(n);return n}},{key:"moveLeft",value:function(){this.moveRow(function(t){return t.push(0)})}},{key:"moveRight",value:function(){this.moveRow(function(t){return t.unshift(0)})}},{key:"moveUp",value:function(){this.moveColumn(function(t){return t.push(0)})}},{key:"moveDown",value:function(){this.moveColumn(function(t){return t.unshift(0)})}},{key:"createField",value:function(){var t=this;return Array(this.size).fill(null).map(function(){return Array(t.size).fill(0)})}},{key:"copyState",value:function(t){return t.map(function(t){return n(t)})}},{key:"isChanged",value:function(t){for(var e=0;e<this.size;e++)for(var n=0;n<this.size;n++)if(t[e][n]!==this.state[e][n])return!0;return!1}},{key:"isPlaying",get:function(){switch(!0){case!this.status.started:case this.status.won:case this.status.lost:return!1;default:return!0}}},{key:"isLost",get:function(){for(var t=this,e=function(e){var n=t.state.map(function(t){return t[e]});if(t.hasMoves(t.state[e])||t.hasMoves(n))return{v:!1}},n=0;n<this.size;n++){var r=e(n);if("object"==(r&&"undefined"!=typeof Symbol&&r.constructor===Symbol?"symbol":typeof r))return r.v}return!0}},{key:"hasMoves",value:function(t){if(t.includes(0))return!0;for(var e=1;e<t.length;e++)if(t[e-1]===t[e])return!0;return!1}},{key:"addRandomCell",value:function(){var t=this.getRandomRow(),e=this.getRandomColumn(t);this.state[t][e]=w(0,this.probability)?2:4}},{key:"getRandomRow",value:function(){for(var t=[],e=0;e<this.size;e++)this.state[e].includes(0)&&t.push(e);return t[w(0,t.length)]}},{key:"getRandomColumn",value:function(t){for(var e=[],n=this.state[t],r=0;r<n.length;r++)n[r]||e.push(r);return e[w(0,e.length)]}},{key:"getScore",value:function(){return this.score}},{key:"getState",value:function(){return this.copyState(this.state)}},{key:"getStatus",value:function(){switch(!0){case!this.status.started:return"idle";case this.status.won:return"win";case this.status.lost:return"lose"}return"playing"}}],function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(e.prototype,t),e}()),b=document.querySelector(".game-score"),L=document.querySelector(".button.start"),S=document.querySelector(".message.message-win"),C=document.querySelector(".message.message-lose"),R=document.querySelector(".message.message-start");function A(t){var e=function(t){var e=t.changedTouches[0];s=e.pageX,o=e.pageY;var n=s-r,a=o-i;if(Math.abs(n)>Math.abs(a)){if(n>15)return t.key="ArrowRight",t;if(n<-15)return t.key="ArrowLeft",t}return a>15?(t.key="ArrowDown",t):a<-15?(t.key="ArrowUp",t):void 0}(t);e&&E(e)}function E(e){var n=k.getState();switch(e.key){case"ArrowUp":k.moveUp();break;case"ArrowRight":k.moveRight();break;case"ArrowDown":k.moveDown();break;case"ArrowLeft":k.moveLeft();break;default:return}L.classList.contains("start")&&h(n,k.getState())&&(L.disabled=!1,L.textContent="Restart",L.classList.add("restart"),L.classList.remove("start")),b.textContent=k.getScore(),f(k.getState(),e.key.replace("Arrow","").toLowerCase());var r=k.getStatus();if("playing"!==r){if(document.removeEventListener("keydown",E),a.removeEventListener("touchstart",t),a.removeEventListener("touchend",A),"win"===r){S.classList.remove("hidden");return}C.classList.remove("hidden")}}L.addEventListener("click",function(){if(L.classList.contains("start")){k.start(),f(k.getState()),R.classList.add("hidden"),L.disabled=!0,document.addEventListener("keydown",E),a.addEventListener("touchstart",t,!1),a.addEventListener("touchend",A,!1);return}k.restart(),k.start(),f(k.getState()),b.textContent="0",S.classList.contains("hidden")||S.classList.add("hidden"),C.classList.contains("hidden")||C.classList.add("hidden"),a.removeEventListener("touchstart",t),a.removeEventListener("touchend",A),a.addEventListener("touchstart",t,!1),a.addEventListener("touchend",A,!1),document.removeEventListener("keydown",E),document.addEventListener("keydown",E)})}();
//# sourceMappingURL=index.c7dba73e.js.map
