let t,e,s,n;function i(s){s.preventDefault();let n=s.touches[0];t=n.pageX,e=n.pageY}const r=document.querySelector(".game-field tbody"),o={left:(t,e)=>(function(t,e){for(let s=0;s<t.length;s++){let n=t[s],i=n.length-1,r=0,o=!1;for(let t=0;t<i&&!o;t++){if(t===r&&n[t]===e[s][t]){r++;continue}if(!n[t]){o=!0,n.splice(t,1),n.push(0);continue}n[t+1]&&n[t]===n[t+1]&&(o=!0,n[t]=2*+n[t],n.splice(t+1,1),n.push(0))}}return t})(t,e),right:(t,e)=>(function(t,e){for(let s=0;s<t.length;s++){let n=t[s],i=!1,r=n.length-1;for(let t=n.length-1;t>0&&!i;t--){if(t===r&&n[t]===e[s][t]){r--;continue}if(!n[t]){i=!0,n.splice(t,1),n.unshift(0);continue}n[t-1]&&n[t]===n[t-1]&&(i=!0,n[t]=2*+n[t],n.splice(t-1,1),n.unshift(0))}}return t})(t,e),up:(t,e)=>(function(t,e){for(let s=0;s<t.length;s++){let n=t.length-1,i=0,r=!1;for(let o=0;o<n&&!r;o++){if(o===i&&t[o][s]===e[o][s]){i++;continue}if(!t[o][s]){r=!0,f(t,o,s);continue}t[o+1][s]&&t[o][s]===t[o+1][s]&&(t[o][s]*=2,r=!0,f(t,o+1,s))}}return t})(t,e),down:(t,e)=>(function(t,e){for(let s=0;s<t.length;s++){let n=!1,i=t.length-1;for(let r=t.length-1;r>0&&!n;r--){if(i===r&&t[r][s]===e[r][s]){i--;continue}if(!t[r][s]){n=!0,g(t,r,s);continue}t[r-1][s]&&t[r][s]===t[r-1][s]&&(t[r][s]=2*+t[r][s],n=!0,g(t,r-1,s))}}return t})(t,e)};let a=null,l=null;function h(t,e){if(a){if(!u(a,t))return;clearTimeout(l),m(),d(a),a=null,l=null}let s=[c(m())];if(!u(s[0],t)){d(t);return}if(e){for(;;)if(s.push(c(o[e](c(s.at(-1)),t))),!u(s.at(-1),s.at(-2))){s.pop(),s.shift(),s[s.length-1]=t;break}a=t,function t(e,s){if(m(),d(e.shift()),e.length){l=setTimeout(t,s,e,s);return}a=null,l=null}(s,250/s.length);return}d(t)}function u(t,e){for(let s=0;s<t.length;s++)for(let n=0;n<t[s].length;n++)if(t[s][n]!==e[s][n])return!0;return!1}function c(t){return t.map(t=>[...t])}function d(t){for(let e=0;e<t.length;e++){let s=t[e];for(let n=0;n<s.length;n++)t[e][n]&&(r.rows[e].cells[n].textContent=t[e][n],r.rows[e].cells[n].classList.add(`field-cell--${t[e][n]}`))}}function f(t,e,s){let n=t.length-1;for(let i=e;i<n;i++)t[i][s]=t[i+1][s];t[n][s]=0}function g(t,e,s){for(let n=e;n>0;n--)t[n][s]=t[n-1][s];t[0][s]=0}function m(){let t=[];for(let e=0;e<r.rows.length;e++){t.push([]);let s=r.rows[e].cells;for(let n=0;n<s.length;n++)t[e].push(+s[n].textContent),s[n].textContent&&(s[n].classList.remove(`field-cell--${s[n].textContent}`),s[n].textContent="")}return t}function w(t,e){return Math.floor(Math.random()*(e-t))+t}const v=new class{size=4;probability=10;status={started:!1,lost:!1,won:!1};score=0;constructor(t=this.createField()){this.state=t,this.initialState=this.copyState(t)}start(){if(!this.isPlaying){this.status.started=!0;for(let t=0;t<2;t++)this.addRandomCell()}}restart(){this.score=0,this.state=this.copyState(this.initialState),this.status.won=!1,this.status.lost=!1,this.status.started=!1}moveRow(t){if(!this.isPlaying)return;let e=this.getState();for(let e=0;e<this.size;e++)this.state[e]=this.stackRow(this.state[e],t);this.isChanged(e)&&(this.addRandomCell(),this.status.lost=this.isLost)}moveColumn(t){if(!this.isPlaying)return;let e=this.getState();for(let e=0;e<this.size;e++)this.stackRow(this.state.map(t=>t[e]),t).forEach((t,s)=>this.state[s][e]=t);this.isChanged(e)&&(this.addRandomCell(),this.status.lost=this.isLost)}stackRow(t,e){let s=t.filter(Boolean);for(let t=1;t<s.length;t++)if(s[t-1]===s[t]){let e=2*s[t-1];2048===e&&(this.status.won=!0),s[t-1]=e,this.score+=e,s.splice(t,1)}for(;s.length!==this.size;)e(s);return s}moveLeft(){this.moveRow(t=>t.push(0))}moveRight(){this.moveRow(t=>t.unshift(0))}moveUp(){this.moveColumn(t=>t.push(0))}moveDown(){this.moveColumn(t=>t.unshift(0))}createField(){return Array(this.size).fill(null).map(()=>Array(this.size).fill(0))}copyState(t){return t.map(t=>[...t])}isChanged(t){for(let e=0;e<this.size;e++)for(let s=0;s<this.size;s++)if(t[e][s]!==this.state[e][s])return!0;return!1}get isPlaying(){switch(!0){case!this.status.started:case this.status.won:case this.status.lost:return!1;default:return!0}}get isLost(){for(let t=0;t<this.size;t++){let e=this.state.map(e=>e[t]);if(this.hasMoves(this.state[t])||this.hasMoves(e))return!1}return!0}hasMoves(t){if(t.includes(0))return!0;for(let e=1;e<t.length;e++)if(t[e-1]===t[e])return!0;return!1}addRandomCell(){let t=this.getRandomRow(),e=this.getRandomColumn(t);this.state[t][e]=w(0,this.probability)?2:4}getRandomRow(){let t=[];for(let e=0;e<this.size;e++)this.state[e].includes(0)&&t.push(e);return t[w(0,t.length)]}getRandomColumn(t){let e=[],s=this.state[t];for(let t=0;t<s.length;t++)s[t]||e.push(t);return e[w(0,e.length)]}getScore(){return this.score}getState(){return this.copyState(this.state)}getStatus(){switch(!0){case!this.status.started:return"idle";case this.status.won:return"win";case this.status.lost:return"lose"}return"playing"}},p=document.querySelector(".game-score"),L=document.querySelector(".button.start"),y=document.querySelector(".message.message-win"),S=document.querySelector(".message.message-lose"),C=document.querySelector(".message.message-start");function R(i){let r=function(i){let r=i.changedTouches[0];s=r.pageX,n=r.pageY;let o=s-t,a=n-e;if(Math.abs(o)>Math.abs(a)){if(o>15)return i.key="ArrowRight",i;if(o<-15)return i.key="ArrowLeft",i}return a>15?(i.key="ArrowDown",i):a<-15?(i.key="ArrowUp",i):void 0}(i);r&&k(r)}function k(t){let e=v.getState();switch(t.key){case"ArrowUp":v.moveUp();break;case"ArrowRight":v.moveRight();break;case"ArrowDown":v.moveDown();break;case"ArrowLeft":v.moveLeft();break;default:return}L.classList.contains("start")&&u(e,v.getState())&&(L.disabled=!1,L.textContent="Restart",L.classList.add("restart"),L.classList.remove("start")),p.textContent=v.getScore(),h(v.getState(),t.key.replace("Arrow","").toLowerCase());let s=v.getStatus();if("playing"!==s){if(document.removeEventListener("keydown",k),r.removeEventListener("touchstart",i),r.removeEventListener("touchend",R),"win"===s){y.classList.remove("hidden");return}S.classList.remove("hidden")}}L.addEventListener("click",()=>{if(L.classList.contains("start")){v.start(),h(v.getState()),C.classList.add("hidden"),L.disabled=!0,document.addEventListener("keydown",k),r.addEventListener("touchstart",i,!1),r.addEventListener("touchend",R,!1);return}v.restart(),v.start(),h(v.getState()),p.textContent="0",y.classList.contains("hidden")||y.classList.add("hidden"),S.classList.contains("hidden")||S.classList.add("hidden"),r.removeEventListener("touchstart",i),r.removeEventListener("touchend",R),r.addEventListener("touchstart",i,!1),r.addEventListener("touchend",R,!1),document.removeEventListener("keydown",k),document.addEventListener("keydown",k)});
//# sourceMappingURL=index.47927967.js.map
